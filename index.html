<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="container-fluid">

      <div class="row heading">
        <div class="col-md-12 centered">
          <div class="logo"><img src="/images/owasp.png"/></div>
          <h1>OWASP ThreatSpec</h1>
          <h2>Code-driven threat modelling</h2>
        </div>
      </div>

      <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
          <div class="col-md-4 centered step">
            <div class="inside">
              <h3>Develop</h3>
              <p>Developers, operations and security engineers work closely together reviewing and annotating code with threat modeling metadata.</p>
            </div>
          </div>
          <div class="col-md-4 centered step">
            <div class="inside">
              <h3>Parse</h3>
              <p> Use a parser to turn ThreatSpec code annotations into an intermediate json file.  </p>
            </div>
          </div>
          <div class="col-md-4 centered step">
            <div class="inside">
              <h3>Report</h3>
              <p> Run a report against one or more intermediate json files, even if they originate from different languages. Use the reports for further guide your threat modelling focus etc... </p>
            </div>
          </div>
        </div>
        <div class="col-md-1"></div>
      </div>
      <div class="row">
        <div class="col-md-12 centered downloads">
          <h3>Supported languages</h3>
          <ul class="list-inline">
            <li><img src="/images/go.png" height="80"/></li>
            <li><img src="/images/python.png" height="80"/></li>
            <li><img src="/images/node.png" height="80"/></li>
          </ul>
          <h3>Reporting tools</h3>
          <ul class="list-inline tools">
            <li><a href="">Simple CSV</a></li>
            <li><a href="">Markdown/PDF/HTML</a></li>
            <li><a href="">Jenkins (CI) test</a></li>
          </ul>
        </div>
      </div>

      <div class="row demo">
        <div class="col-md-12 centered">
          <h3>Try code-driven threat modelling</h3> 
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <button class="btn btn-default" type="submit">Parse &amp; Report <span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>
          <button class="btn btn-default" type="submit">Reset <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
        </div>
        <div class="col-md-6">

          <!-- Nav tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#report" aria-controls="report" role="tab" data-toggle="tab">Report</a></li>
            <li role="presentation"><a href="#dfd" aria-controls="dfd" role="tab" data-toggle="tab">Data Flow Diagram</a></li>
            <li role="presentation"><a href="#json" aria-controls="json" role="tab" data-toggle="tab">JSON</a></li>
            <li role="presentation"><a href="#debug" aria-controls="debug" role="tab" data-toggle="tab">Debug</a></li>
          </ul>

          </div>

        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div id="editor">
// @accepts arbitrary file writes to WebApp:FileSystem with filename restrictions
// @mitigates WebApp:FileSystem against unauthorised access with strict file permissions
func (p *Page) save() error {
  filename := p.Title + ".txt"
  return ioutil.WriteFile(filename, p.Body, 0600)
}

// @accepts arbitrary file reads to WebApp:FileSystem with filename restrictions
func loadPage(title string) (*Page, error) {
  filename := title + ".txt"
  body, err := ioutil.ReadFile(filename)
  if err != nil {
    return nil, err
  }
  return &Page{Title: title, Body: body}, nil
}

func viewHandler(w http.ResponseWriter, r *http.Request, title string) {
  p, err := loadPage(title)
  if err != nil {
    http.Redirect(w, r, "/edit/"+title, http.StatusFound)
    return
  }
  renderTemplate(w, "view", p)
}

// @exposes WebApp:App to XSS injection with insufficient input validation
func editHandler(w http.ResponseWriter, r *http.Request, title string) {
  p, err := loadPage(title)
  if err != nil {
    p = &Page{Title: title}
  }
  renderTemplate(w, "edit", p)
}

// @exposes WebApp:App to content injection with insufficient input validation
func saveHandler(w http.ResponseWriter, r *http.Request, title string) {
  body := r.FormValue("body")
  p := &Page{Title: title, Body: []byte(body)}
  err := p.save()
  if err != nil {
    http.Error(w, err.Error(), http.StatusInternalServerError)
    return
  }
  http.Redirect(w, r, "/view/"+title, http.StatusFound)
}
          </div>
          <script src="/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
          <script>
              var editor = ace.edit("editor");
              editor.setTheme("ace/theme/chrome");
              editor.getSession().setMode("ace/mode/javascript");
          </script>
        </div>
        <div class="col-md-6">
          <!-- Tab panes -->
          <div class="tab-content report">
            <div role="tabpanel" class="tab-pane active" id="report">
       <h1>
<a id="user-content-threatspec-report-for-" class="anchor" href="#threatspec-report-for-" aria-hidden="true"><span class="octicon octicon-link"></span></a>ThreatSpec Report for ...</h1>

<h1>
<a id="user-content-analysis" class="anchor" href="#analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Analysis</h1>

<ul>
<li>Functions found: 64</li>
<li>Functions covered: 10.94% (7)</li>
<li>Functions tested: 14.29% (1)</li>
</ul>

<h1>
<a id="user-content-components" class="anchor" href="#components" aria-hidden="true"><span class="octicon octicon-link"></span></a>Components</h1>

<h2>
<a id="user-content-cryptography" class="anchor" href="#cryptography" aria-hidden="true"><span class="octicon octicon-link"></span></a>cryptography</h2>

<h3>
<a id="user-content-threat-use-of-insufficiently-random-values-cwe-330" class="anchor" href="#threat-use-of-insufficiently-random-values-cwe-330" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: Use of Insufficiently Random Values (CWE-330)</h3>

<ul>
<li>Mitigation: standard package which uses secure implementation (RandomBytes in helpers.go:51)</li>
</ul>

<h3>
<a id="user-content-threat-use-of-password-hash-with-insufficient-computational-effort-cwe-916" class="anchor" href="#threat-use-of-password-hash-with-insufficient-computational-effort-cwe-916" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: Use of Password Hash With Insufficient Computational Effort (CWE-916)</h3>

<ul>
<li>Mitigation: PBKDF2 provided by standard package (ExpandKey in helpers.go:93)</li>
</ul>

<h3>
<a id="user-content-threat-use-of-a-one-way-hash-without-a-salt" class="anchor" href="#threat-use-of-a-one-way-hash-without-a-salt" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: Use of a One-Way Hash without a Salt</h3>

<ul>
<li>Mitigation: secure generation of salt using strong PRNG (ExpandKey in helpers.go:93)</li>
</ul>

<h3>
<a id="user-content-threat-weak-cipher" class="anchor" href="#threat-weak-cipher" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: weak cipher</h3>

<ul>
<li>Mitigation: strong encryption cipher in CBC mode (AESEncrypt in helpers.go:126)</li>
<li>Mitigation: sufficient key size (AESEncrypt in helpers.go:126)</li>
</ul>

<h3>
<a id="user-content-threat-failure-to-use-a-random-iv-in-cbc-mode" class="anchor" href="#threat-failure-to-use-a-random-iv-in-cbc-mode" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: failure to use a random IV in CBC mode</h3>

<ul>
<li>Mitigation: generated random IV (AESEncrypt in helpers.go:126)</li>
</ul>

<h3>
<a id="user-content-threat-weak-private-key" class="anchor" href="#threat-weak-private-key" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: weak private key</h3>

<ul>
<li>Mitigation: RSA key generated using standard package (GenerateRSAKey in helpers.go:177)</li>
<li>Mitigation: sufficient RSa key size of 2048 bits (GenerateRSAKey in helpers.go:177)</li>
<li>Exposure: EC key generated by third-party package (GenerateECKey in helpers.go:189)</li>
</ul>

<h3>
<a id="user-content-threat-something" class="anchor" href="#threat-something" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: something</h3>

<ul>
<li>Mitigation: RSA encryption using OAEP with SHA-256 (rsaEncrypt in helpers.go:281)</li>
</ul>

<h3>
<a id="user-content-threat-something-else" class="anchor" href="#threat-something-else" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: something else</h3>

<ul>
<li>Mitigation: Elliptic Curve Integrated Encryption Scheme (eciesEncrypt in helpers.go:300)</li>
</ul>

<h3>
<a id="user-content-threat-something-bleh" class="anchor" href="#threat-something-bleh" aria-hidden="true"><span class="octicon octicon-link"></span></a>Threat: something bleh</h3>

<ul>
<li>Exposure: encryption performed by third-party package (eciesEncrypt in helpers.go:300)</li>
</ul>

            </div>

            <div role="tabpanel" class="tab-pane" id="dfd">
            </div>

            <div role="tabpanel" class="tab-pane" id="json">
<pre>
{
  "specification": {
    "name": "ThreatSpec",
    "version": "0.1.0"
  },
  "document": {
    "created": 1449221919,
    "updated": 1449221919
  },
  "boundaries": {
    "@user": {
      "name": "User"
    },
    "@webapp": {
      "name": "WebApp"
    }
  },
  "components": {
    "@app": {
      "name": "App"
    },
    "@browser": {
      "name": "Browser"
    },
    "@filesystem": {
      "name": "FileSystem"
    },
    "@web": {
      "name": "Web"
    }
  },
  "threats": {
    "@arbitrary_file_reads": {
      "name": "arbitrary file reads"
    },
    "@arbitrary_file_writes": {
      "name": "arbitrary file writes"
    },
    "@content_injection": {
      "name": "content injection"
    },
    "@cwe_319_cleartext_transmission": {
      "name": "The software transmits sensitive or security-critical data in cleartext in a communication channel that can be sniffed by unauthorized actors"
    },
    "@privilege_escalation": {
      "name": "privilege escalation"
    },
    "@resource_access_abuse": {
      "name": "resource access abuse"
    },
    "@unauthorised_access": {
      "name": "unauthorised access"
    },
    "@xss_injection": {
      "name": "XSS injection"
    }
  },
  "projects": {
    "Simple": {
      "mitigations": {
        "@basic_input_validation": [
          {
            "mitigation": "basic input validation",
            "boundary": "@webapp",
            "component": "@web",
            "threat": "@resource_access_abuse",
            "source": {
              "function": "main.makeHandler",
              "file": "simple.go",
              "line": 86
            }
          }
        ],
        "@nonprivileged_port": [
          {
            "mitigation": "non-privileged port",
            "boundary": "@webapp",
            "component": "@web",
            "threat": "@privilege_escalation",
            "source": {
              "function": "main.main",
              "file": "simple.go",
              "line": 99
            }
          }
        ],
        "@strict_file_permissions": [
          {
            "mitigation": "strict file permissions",
            "boundary": "@webapp",
            "component": "@filesystem",
            "threat": "@unauthorised_access",
            "source": {
              "function": "main.(*Page).save",
              "file": "simple.go",
              "line": 29
            }
          }
        ]
      },
      "exposures": {
        "@insufficient_input_validation": [
          {
            "exposure": "insufficient input validation",
            "boundary": "@webapp",
            "component": "@app",
            "threat": "@xss_injection",
            "source": {
              "function": "main.editHandler",
              "file": "simple.go",
              "line": 54
            }
          },
          {
            "exposure": "insufficient input validation",
            "boundary": "@webapp",
            "component": "@app",
            "threat": "@content_injection",
            "source": {
              "function": "main.saveHandler",
              "file": "simple.go",
              "line": 63
            }
          }
        ]
      },
      "transfers": {
        "@nonsensitive_information": [
          {
            "transfer": "non-sensitive information",
            "boundary": "@user",
            "component": "@browser",
            "threat": "@cwe_319_cleartext_transmission",
            "source": {
              "function": "main.main",
              "file": "simple.go",
              "line": 99
            }
          }
        ]
      },
      "acceptances": {
        "@filename_restrictions": [
          {
            "acceptance": "filename restrictions",
            "boundary": "@webapp",
            "component": "@filesystem",
            "threat": "@arbitrary_file_writes",
            "source": {
              "function": "main.(*Page).save",
              "file": "simple.go",
              "line": 29
            }
          },
          {
            "acceptance": "filename restrictions",
            "boundary": "@webapp",
            "component": "@filesystem",
            "threat": "@arbitrary_file_reads",
            "source": {
              "function": "main.loadPage",
              "file": "simple.go",
              "line": 35
            }
          }
        ]
      }
    }
  }
}
</pre>

            </div>
            <div role="tabpanel" class="tab-pane" id="debug">
<pre>
Unmigitated exposure in simple.go:34:37:save: insufficient path validation
Unmigitated exposure in simple.go:43:50:loadPage: insufficient path validation
Unmigitated exposure in simple.go:68:74:editHandler: insufficient input validation
Unmigitated exposure in simple.go:80:89:saveHandler: insufficient input validation
</pre>
 
            </div>
        </div>
      </div>
    </div>

      <div class="row footer">
        <div class="col-md-12">
          <h2>footer</h2>
        </div>
      </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
